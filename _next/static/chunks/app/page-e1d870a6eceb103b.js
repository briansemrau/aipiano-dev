(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8304:function(t,e,r){Promise.resolve().then(r.bind(r,6234))},6234:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return x}});var i=r(9268),n=r(6006),a=r(8829);let o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function c(t){return Math.floor(t/12-1)}function s(t){let e=c(t),r=o[t%12];return"".concat(r).concat(e)}let l=Array(88).fill(0).map((t,e)=>({isWhite:[0,2,4,5,7,9,11].includes((e+9)%12),midiCode:e+9,noteName:s(e+9),noteOctave:c(e+9)})),u=l.filter(t=>t.isWhite),d=l.filter(t=>!t.isWhite);var h=r(5591);let m=t=>{let{x:e,y:r,height:n,pianoScale:a,highlightedNotes:o}=t;return(0,i.jsxs)(h.ZA,{x:e,y:r,children:[a.whiteKeys().map((t,e)=>(0,i.jsxs)(h.ZA,{x:t.x,y:0,children:[(0,i.jsx)(h.UL,{x:0,y:0,stroke:"black",fill:o.includes(t.midiCode)?"hotpink":"white",width:t.width,height:n}),(0,i.jsx)(h.xv,{x:0,y:n,fontSize:9,fill:o.includes(t.midiCode)?"white":"black",text:t.noteName})]},t.midiCode)),a.blackKeys().map(t=>(0,i.jsx)(h.ZA,{x:t.x,y:0,children:(0,i.jsx)(h.UL,{x:0,y:0,fill:o.includes(t.midiCode)?"hotpink":"black",height:n/2,width:t.width})},t.midiCode))]})};var f=r(3576),p=r(5622),y=r(2801);function x(){let[t,e]=n.useState(0),[r,o]=n.useState(0),[c,l]=n.useState(.1),[x,v]=n.useState({}),[g,b]=n.useState([]),[T,j]=n.useState("nocturne_9_2"),w=(0,n.useRef)(0),[k,C]=n.useState(null),N=(0,n.useRef)((function(t){let e=[9,96],r,i={};function n(){let t=r?Math.round((r[1]-r[0])/u.length):0,e=t/2;u.forEach((e,r)=>{i[e.midiCode]={...e,x:r*t,y:0,width:t}}),d.forEach((r,n)=>{let a=u.findIndex(t=>t.midiCode===r.midiCode-1);i[r.midiCode]={...r,x:a*t+t/2+e/2,y:0,width:e}})}function a(t){return(t<9||t>96)&&console.error("MIDI code ".concat(t," is not a valid piano note. Piano notes should be between A-1(9) and C7(96)")),i[t]}return n(),a.domain=()=>e,a.range=t=>t?(r=t,n(),a):r,a.pianoKeys=()=>Object.values(i),a.whiteKeys=()=>a.pianoKeys().filter(t=>t.isWhite),a.blackKeys=()=>a.pianoKeys().filter(t=>!t.isWhite),a})().range([0,800])),A=(0,n.useRef)((0,a.Z)().range([530,0]));async function S(){"started"===f.h4().state?f.h4().pause():("paused"===f.h4().state||(null===k&&C(new p.Z({minify:!0}).toDestination()),f.h4().bpm.value=120,await f.BL(),e(f.Sy().immediate())),f.h4().start())}async function _(){"stopped"!==f.h4().state&&(f.h4().stop(),f.h4().cancel(),null==k||k.releaseAll(),E(T))}function E(t){switch(console.log("prompt",t),t){case"none":b([]),v({});break;case"nocturne_9_2":b([{pitch:60,velocity:1,duration:1,startTime:0},{pitch:61,velocity:.5,duration:1.5,startTime:1},{pitch:64,velocity:.1,duration:1,startTime:4},{pitch:59,velocity:1,duration:1,startTime:5}]),v({50:{value:50,velocity:1,startTime:0},51:{value:51,velocity:1,startTime:1},52:{value:52,velocity:.5,startTime:4}});break;case"2":b([{pitch:48,velocity:1,duration:.2,startTime:0},{pitch:52,velocity:1,duration:.2,startTime:.1},{pitch:55,velocity:1,duration:.2,startTime:.2},{pitch:60,velocity:1,duration:.2,startTime:.3},{pitch:55,velocity:1,duration:.2,startTime:.4},{pitch:52,velocity:1,duration:.2,startTime:.5},{pitch:48,velocity:1,duration:.2,startTime:.6}]),v({})}}A.current.domain([c,c+5]),(0,n.useEffect)(()=>{E(T)},[T]);let O=(0,n.useRef)(0);return(0,n.useEffect)(()=>{if(O.current>r){O.current=r;return}g.forEach(e=>{if(e.startTime>=O.current&&e.startTime<r){let r=s(e.pitch);null==k||k.triggerAttack(r,e.startTime+t+.1,e.velocity)}if(e.startTime+e.duration>=O.current&&e.startTime+e.duration<r){let r=s(e.pitch);null==k||k.triggerRelease(r,e.startTime+e.duration+t+.1)}}),Object.entries(x).map(e=>{let[i,n]=e;if(n.startTime>=O.current&&n.startTime<r){let e=s(n.value);null==k||k.triggerAttack(e,n.startTime+t+.1,n.velocity)}}),b(t=>t.filter(t=>t.startTime+t.duration>c)),O.current=r},[r]),(0,n.useEffect)(()=>((function t(){w.current=requestAnimationFrame(()=>{o(f.h4().seconds),l(f.h4().seconds-.1),t()})})(),()=>cancelAnimationFrame(w.current)),[]),(0,i.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-between p-4",children:[(0,i.jsx)("div",{className:"horizontal-container",children:(0,i.jsxs)("select",{className:"rounded-lg border border-gray-300 px-2 py-1 mr-2",onChange:t=>j(t.target.value),value:T,children:[(0,i.jsx)("option",{value:"none",children:"Unconditional"}),(0,i.jsx)("option",{value:"nocturne_9_2",children:"Nocturne Op.9 No.2"}),(0,i.jsx)("option",{value:"2",children:"Prompt 2"})]})}),(0,i.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,i.jsx)("button",{onClick:S,className:"rounded-lg border border-gray-300 px-3 py-2 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30",children:"started"===f.h4().state?(0,i.jsx)(y.Wh,{}):(0,i.jsx)(y.gmG,{})}),(0,i.jsx)("button",{onClick:_,className:"rounded-lg border border-gray-300 px-3 py-2 transition-colors hover:border-gray-300 hover:bg-gray-100 hover:dark:border-neutral-700 hover:dark:bg-neutral-800/30",children:(0,i.jsx)(y.WLu,{})})]}),(0,i.jsx)(h.Hf,{height:600,width:800,children:(0,i.jsxs)(h.mh,{children:[(0,i.jsx)(h.x1,{points:[0,A.current(r),800,A.current(r)],stroke:"red",opacity:.5,strokeWidth:2,dash:[4,4]}),g.filter(t=>t.startTime+t.duration>c&&t.startTime<c+5).map(t=>{let e=N.current(t.pitch).width-2,r=Math.abs(A.current(t.duration)-A.current(0)),n=N.current(t.pitch).x,a=A.current(t.startTime)-r,o=t.startTime<=c&&t.startTime+t.duration>=c;return(0,i.jsx)(h.UL,{x:n,y:a,width:e,height:r,cornerRadius:4,fill:"rgba(0, 255, 255, ".concat(.8*t.velocity+.2,")"),shadowColor:"cyan",shadowBlur:o?24:8,shadowOpacity:o?1:.4},"".concat(t.pitch,"-").concat(t.startTime))}),Object.entries(x).map(t=>{let[e,r]=t,n=Math.max(c,r.startTime),a=Math.max(1,c-n+2),o=N.current(e).width,s=Math.abs(A.current(a)-A.current(0)),l=N.current(e).x,u=A.current(n)-s,d=n<=c&&n+a>=c;return(0,i.jsx)(h.UL,{x:l,y:u,width:o,height:s,cornerRadius:4,fillLinearGradientStartPointY:s,fillLinearGradientEndPointY:0,fillLinearGradientColorStops:[0,"rgba(0,255,255,".concat(.8*r.velocity+.2,")"),.5,"rgba(0,255,255,".concat((.8*r.velocity+.2)*.33,")"),1,"rgba(0,0,0,0)"],shadowColor:"cyan",shadowBlur:d?24:8,shadowOpacity:d?1:.4},"".concat(e,"-").concat(n))}),(0,i.jsx)(m,{x:0,y:530,height:70,pianoScale:N.current,highlightedNotes:Object.entries(x).filter(t=>{let[e,r]=t;return r.startTime<c}).map(t=>{let[e,r]=t;return r.value}).concat(g.filter(t=>t.startTime+t.duration>c&&t.startTime<c).map(t=>t.pitch))})]})})]})}}},function(t){t.O(0,[774,132,327,667,488,744],function(){return t(t.s=8304)}),_N_E=t.O()}]);